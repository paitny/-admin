"use strict";(self["webpackChunkmyblog"]=self["webpackChunkmyblog"]||[]).push([[152],{52152:function(e,s,a){a.r(s),a.d(s,{default:function(){return D}});var r=a(73396);const t=e=>((0,r.dD)("data-v-f6ea843c"),e=e(),(0,r.Cn)(),e),o={id:"User"},l=t((()=>(0,r._)("h2",null,"修改用户名",-1))),u=t((()=>(0,r._)("h2",null,"修改密码",-1))),n=t((()=>(0,r._)("h2",null,"头像上传",-1)));function d(e,s,a,t,d,i){const p=(0,r.up)("UpdateName"),m=(0,r.up)("UpdatePass"),c=(0,r.up)("UpdatePhoto");return(0,r.wg)(),(0,r.iD)("div",o,[(0,r._)("article",null,[l,(0,r.Wm)(p)]),(0,r._)("article",null,[u,(0,r.Wm)(m)]),(0,r._)("article",null,[n,(0,r.Wm)(c)])])}var i=a(87139);const p={class:"UpdateName"},m={class:"code"},c=(0,r.Uk)("确认修改");function h(e,s,a,t,o,l){const u=(0,r.up)("el-form-item"),n=(0,r.up)("el-input"),d=(0,r.up)("el-button"),h=(0,r.up)("el-form");return(0,r.wg)(),(0,r.iD)("div",p,[(0,r.Wm)(h,{model:o.userForm,"status-icon":"",rules:o.rules,ref:"userForm","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{label:"当前用户名：","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r._)("span",m,(0,i.zw)(e.userInfo.user),1)])),_:1}),(0,r.Wm)(u,{label:"新用户名：",prop:"user","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{modelValue:o.userForm.user,"onUpdate:modelValue":s[0]||(s[0]=e=>o.userForm.user=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(u,{"label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{type:"primary",onClick:l.submit},{default:(0,r.w5)((()=>[c])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])}a(21703);var f=a(20065),w={name:"UpdateName",data(){return{userForm:{user:""},rules:{user:[{validator:(e,s,a)=>{(s.length<2||s.length>8)&&a(new Error("请输入2~8位的用户名")),/^[\w\u4e00-\u9fa5\u0800-\u4e00\uac00-\ud7ff]+$/.test(s)||a(new Error("只允许 数字 字母 _ 中/日/韩文")),s===this.userInfo.user&&a(new Error("用户名没有变化...")),a()}}]}}},computed:{...(0,f.rn)(["userInfo"])},methods:{...(0,f.OI)(["loginSuccess"]),submit(){this.$refs.userForm.validate((async e=>{if(!e)return!1;{let{data:e}=await this.$axios({method:"POST",url:"/personal/user",data:{user:this.userForm.user}});if(e.code)return this.$message.error(e.msg);this.$message.success("用户名修改成功"),this.loginSuccess(e.data),this.$refs.userForm.resetFields()}}))}}},g=a(40089);const b=(0,g.Z)(w,[["render",h],["__scopeId","data-v-6ab5606e"]]);var v=b;const U={id:"UpdatePass"},F=(0,r.Uk)("确认修改");function _(e,s,a,t,o,l){const u=(0,r.up)("el-input"),n=(0,r.up)("el-form-item"),d=(0,r.up)("el-button"),i=(0,r.up)("el-form");return(0,r.wg)(),(0,r.iD)("div",U,[(0,r.Wm)(i,{model:o.passForm,"status-icon":"",rules:o.rules,ref:"passForm","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(n,{label:"原密码：",prop:"pass","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{type:"password",modelValue:o.passForm.oldPass,"onUpdate:modelValue":s[0]||(s[0]=e=>o.passForm.oldPass=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(n,{label:"新密码：",prop:"pass","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{type:"password",modelValue:o.passForm.pass,"onUpdate:modelValue":s[1]||(s[1]=e=>o.passForm.pass=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(n,{label:"确认新密码：",prop:"pass2","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{type:"password",modelValue:o.passForm.pass2,"onUpdate:modelValue":s[2]||(s[2]=e=>o.passForm.pass2=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(n,{"label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{type:"primary",onClick:l.submit},{default:(0,r.w5)((()=>[F])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])}var W={name:"UpdatePass",data(){return{passForm:{oldPass:"",pass:"",pass2:""},rules:{pass:[{validator(e,s,a){(s.length<6||s.length>18)&&a(new Error("请输入6~18位的密码")),/^[\w\[\]\/\\~`|<>,.?;':"{}!@#$%^&*()_+=-]+$/.test(s)||a(new Error("不允许的密码字符")),a()},trigger:"input"}],pass2:[{validator:(e,s,a)=>{this.passForm.pass!==s&&a(new Error("两次输入密码不一致")),a()}}]}}},methods:{...(0,f.OI)(["loginOut"]),submit(){this.$refs.passForm.validate((async e=>{if(!e)return!1;{let{data:e}=await this.$axios({method:"POST",url:"/personal/pass",data:{oldPass:this.passForm.oldPass,pass:this.passForm.pass}});if(e.code)return this.$message.error(e.msg);this.$message.success("密码修改成功，请重新登录"),this.loginOut(),this.$refs.passForm.resetFields(),this.$router.push("/")}}))}}};const $=(0,g.Z)(W,[["render",_]]);var P=$;const y={id:"UpdatePhoto"},k=["src"],I={key:1,class:"el-icon-plus avatar-uploader-icon"};function V(e,s,a,t,o,l){const u=(0,r.up)("el-alert"),n=(0,r.up)("el-upload");return(0,r.wg)(),(0,r.iD)("div",y,[(0,r.Wm)(u,{title:"上传头像",type:"warning",description:"点击下方 + 号上传并修改头像",closable:!1,"show-icon":""}),(0,r.Wm)(n,{class:"avatar-uploader",action:e.baseURL+"/personal/photo","show-file-list":!1,"with-credentials":!0,"on-success":l.handleAvatarSuccess,"before-upload":l.beforeAvatarUpload},{default:(0,r.w5)((()=>[o.imageUrl?((0,r.wg)(),(0,r.iD)("img",{key:0,src:o.imageUrl,class:"avatar"},null,8,k)):((0,r.wg)(),(0,r.iD)("i",I))])),_:1},8,["action","on-success","before-upload"])])}var x={name:"UpdatePhoto",data(){return{imageUrl:""}},methods:{...(0,f.OI)(["loginSuccess"]),handleAvatarSuccess(e,s){if(e.code)return this.$message.error("上传失败，是稍后再试");this.imageUrl=URL.createObjectURL(s.raw),this.loginSuccess(e.data)},beforeAvatarUpload(e){const s=/^image\/(jpeg|png)$/.test(e.type),a=e.size/1024/1024<2;return s||this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),a||this.$message.error("上传头像图片大小不能超过 2MB!"),s&&a}}};const E=(0,g.Z)(x,[["render",V],["__scopeId","data-v-a9d6dae6"]]);var O=E,S={name:"User",components:{UpdateName:v,UpdatePass:P,UpdatePhoto:O},computed:{...(0,f.rn)(["userInfo"])},watch:{userInfo(){this.backHome()}},methods:{backHome(){this.userInfo.user||(this.$message.error("当前未登录，无法修改个人信息，已自动返回首页"),this.$router.replace("/"))},unloadFn(){this.userInfo.user}},beforeRouteEnter(e,s,a){a((e=>{e.backHome()}))},created(){window.addEventListener("beforeunload",(e=>{this.unloadFn(e)}))},destroyed(){window.removeEventListener("beforeunload",(e=>{this.unloadFn(e)}))}};const C=(0,g.Z)(S,[["render",d],["__scopeId","data-v-f6ea843c"]]);var D=C}}]);
//# sourceMappingURL=152.97cc2943.js.map
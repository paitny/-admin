"use strict";(self["webpackChunkmyblog"]=self["webpackChunkmyblog"]||[]).push([[42],{94042:function(e,a,t){t.r(a),t.d(a,{default:function(){return Ie}});var r=t(73396);const l={id:"Admin"};function s(e,a,t,s,i,o){const d=(0,r.up)("ArticleAdd"),u=(0,r.up)("el-tab-pane"),m=(0,r.up)("ArticleManger"),n=(0,r.up)("LinkAdd"),c=(0,r.up)("LinkManger"),p=(0,r.up)("ContactMsg"),h=(0,r.up)("SwiperAdd"),g=(0,r.up)("SwiperManger"),w=(0,r.up)("VideoAdd"),f=(0,r.up)("VideoManger"),v=(0,r.up)("el-tabs");return(0,r.wg)(),(0,r.iD)("div",l,[(0,r._)("article",null,[(0,r.Wm)(v,{modelValue:i.activeName,"onUpdate:modelValue":a[0]||(a[0]=e=>i.activeName=e)},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{label:"发表文章",name:"first"},{default:(0,r.w5)((()=>[(0,r.Wm)(d)])),_:1}),(0,r.Wm)(u,{label:"文章管理",name:"second"},{default:(0,r.w5)((()=>[(0,r.Wm)(m)])),_:1}),(0,r.Wm)(u,{label:"添加友链",name:"third"},{default:(0,r.w5)((()=>[(0,r.Wm)(n)])),_:1}),(0,r.Wm)(u,{label:"友链管理",name:"fourth"},{default:(0,r.w5)((()=>[(0,r.Wm)(c)])),_:1}),(0,r.Wm)(u,{label:"反馈收集",name:"fifth"},{default:(0,r.w5)((()=>[(0,r.Wm)(p)])),_:1}),(0,r.Wm)(u,{label:"轮播图上传",name:"sixth"},{default:(0,r.w5)((()=>[(0,r.Wm)(h)])),_:1}),(0,r.Wm)(u,{label:"轮播图管理",name:"seventh"},{default:(0,r.w5)((()=>[(0,r.Wm)(g)])),_:1}),(0,r.Wm)(u,{label:"视频上传",name:"eighth"},{default:(0,r.w5)((()=>[(0,r.Wm)(w)])),_:1}),(0,r.Wm)(u,{label:"视频管理",name:"ninth"},{default:(0,r.w5)((()=>[(0,r.Wm)(f)])),_:1})])),_:1},8,["modelValue"])])])}const i={id:"LinkAdd"},o=(0,r.Uk)("确认添加");function d(e,a,t,l,s,d){const u=(0,r.up)("el-input"),m=(0,r.up)("el-form-item"),n=(0,r.up)("el-button"),c=(0,r.up)("el-form");return(0,r.wg)(),(0,r.iD)("div",i,[(0,r.Wm)(c,{model:s.form,rules:s.rules,ref:"form","status-icon":"","label-position":"top"},{default:(0,r.w5)((()=>[(0,r.Wm)(m,{label:"名称",prop:"name"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{modelValue:s.form.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.name=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(m,{label:"首页",prop:"home"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{modelValue:s.form.home,"onUpdate:modelValue":a[1]||(a[1]=e=>s.form.home=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(m,{label:"图标",prop:"logo"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{modelValue:s.form.logo,"onUpdate:modelValue":a[2]||(a[2]=e=>s.form.logo=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(m,{label:"描述",prop:"des"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{modelValue:s.form.des,"onUpdate:modelValue":a[3]||(a[3]=e=>s.form.des=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(m,null,{default:(0,r.w5)((()=>[(0,r.Wm)(n,{type:"primary",size:"small",onClick:d.submit},{default:(0,r.w5)((()=>[o])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])])}var u=t(20065),m={name:"LinkAdd",data(){return{form:{name:"",home:"",logo:"",des:""},rules:{name:[{required:!0}],des:[{required:!0}],home:[{required:!0,type:"url"}],logo:[{required:!0,type:"url"}]}}},methods:{...(0,u.OI)(["updateLinkData"]),submit(){this.$refs.form.validate((async e=>{if(!e)return!1;{let{data:e}=await this.$axios({method:"POST",url:"/adminServer/link/add",data:this.form});if(e.code)return this.$message.error(e.msg);this.$message.success("添加成功"),this.$refs.form.resetFields(),await this.getLinkData()}}))},async getLinkData(){let{data:e}=await this.$axios({method:"GET",url:"/get/link"});if(e.code)return this.$message.error(e.msg);this.updateLinkData(e.data)}}},n=t(40089);const c=(0,n.Z)(m,[["render",d]]);var p=c;const h={id:"LinkManger"},g=(0,r.Uk)("修改"),w=(0,r.Uk)("删除");function f(e,a,t,l,s,i){const o=(0,r.up)("el-input"),d=(0,r.up)("el-table-column"),u=(0,r.up)("el-button"),m=(0,r.up)("el-table");return(0,r.wg)(),(0,r.iD)("div",h,[(0,r.Wm)(m,{data:e.linkData,border:"",style:{width:"100%"}},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"名称"},{default:(0,r.w5)((e=>[(0,r.Wm)(o,{modelValue:e.row.name,"onUpdate:modelValue":a=>e.row.name=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,r.Wm)(d,{label:"首页"},{default:(0,r.w5)((e=>[(0,r.Wm)(o,{modelValue:e.row.home,"onUpdate:modelValue":a=>e.row.home=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,r.Wm)(d,{label:"logo"},{default:(0,r.w5)((e=>[(0,r.Wm)(o,{modelValue:e.row.logo,"onUpdate:modelValue":a=>e.row.logo=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,r.Wm)(d,{label:"描述"},{default:(0,r.w5)((e=>[(0,r.Wm)(o,{modelValue:e.row.des,"onUpdate:modelValue":a=>e.row.des=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,r.Wm)(d,{fixed:"right",label:"操作"},{default:(0,r.w5)((e=>[(0,r.Wm)(u,{type:"primary",onClick:a=>i.update(e.row),size:"small"},{default:(0,r.w5)((()=>[g])),_:2},1032,["onClick"]),(0,r.Wm)(u,{type:"danger",onClick:a=>i.deleteLink(e.row),size:"small"},{default:(0,r.w5)((()=>[w])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])}var v={name:"LinkManger",data(){return{}},computed:{...(0,u.rn)(["linkData"])},methods:{...(0,u.OI)(["updateLinkData"]),async update(e){let{data:a}=await this.$axios({method:"POST",url:"/adminServer/link/update",data:{_id:e._id,name:e.name,home:e.home,logo:e.logo,des:e.des}});if(a.code)return this.$message.error(a.code);this.$message.success("更新完成")},async deleteLink(e){let{data:a}=await this.$axios({method:"delete",url:"/adminServer/link/delete",data:{_id:e._id}});if(a.code)return this.$message.error(a.code);this.$message.success("删除完成"),await this.getLinkData()},async getLinkData(){let{data:e}=await this.$axios({method:"GET",url:"/get/link"});if(e.code)return this.$message.error(e.msg);this.updateLinkData(e.data)}},created(){this.getLinkData(this)}};const _=(0,n.Z)(v,[["render",f],["__scopeId","data-v-770837da"]]);var b=_,$=t(87139);const W=e=>((0,r.dD)("data-v-f6d8d5f4"),e=e(),(0,r.Cn)(),e),y={id:"ArticleAdd"},k=W((()=>(0,r._)("i",{class:"el-icon-upload"},null,-1))),U=W((()=>(0,r._)("div",{class:"el-upload__text"},[(0,r.Uk)("将.md文件拖到此处，或"),(0,r._)("em",null,"点击上传")],-1))),V={key:1,class:"el-icon-plus avatar-uploader-icon"},C=(0,r.Uk)("确认发表");function x(e,a,t,l,s,i){const o=(0,r.up)("el-input"),d=(0,r.up)("el-form-item"),u=(0,r.up)("el-upload"),m=(0,r.up)("el-button"),n=(0,r.up)("el-form");return(0,r.wg)(),(0,r.iD)("div",y,[(0,r.Wm)(n,{model:s.form,"status-icon":"",ref:"ruleForm","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"标题：","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(o,{modelValue:s.form.title,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.title=e),placeholder:"可通过上传 md 自动获取文件名"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"描述：","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(o,{type:"textarea",modelValue:s.form.des,"onUpdate:modelValue":a[1]||(a[1]=e=>s.form.des=e)},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"md上传：","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{class:"upload-demo",drag:"",action:`${e.baseURL}/adminServer/article/md`,"auto-upload":!1,"on-change":i.fileChange,"on-success":i.md_upload_success,"before-remove":i.beforeRemove,limit:1,ref:"mdForm","with-credentials":!0},{default:(0,r.w5)((()=>[k,U])),_:1},8,["action","on-change","on-success","before-remove"])])),_:1}),(0,r.Wm)(d,{label:"封面图上传：","label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{class:"avatar-uploader",action:`${e.baseURL}/adminServer/article/cover`,"show-file-list":!1,"on-change":i.coverChange,"on-success":i.cover_upload_success,"auto-upload":!1,ref:"imgForm","with-credentials":!0},{default:(0,r.w5)((()=>[s.imageUrl?((0,r.wg)(),(0,r.iD)("div",{key:0,class:"avatar",style:(0,$.j5)({backgroundImage:`url(${s.imageUrl})`})},null,4)):((0,r.wg)(),(0,r.iD)("i",V))])),_:1},8,["action","on-change","on-success"])])),_:1}),(0,r.Wm)(d,{"label-width":"100px"},{default:(0,r.w5)((()=>[(0,r.Wm)(m,{type:"primary",onClick:i.submitForm},{default:(0,r.w5)((()=>[C])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])}var S={name:"ArticleAdd",data(){return{form:{title:"",des:"",md:"",cover:""},imageUrl:""}},methods:{submitForm(){this.$refs.mdForm.submit()},async submit(){let{data:e}=await this.$axios({method:"POST",url:"/adminServer/article/add",data:this.form});if(e.code)return this.$message.error(e.msg);await this.$router.push(`/article/${e.data.id}`)},fileChange(e,a){if("ready"===e.status)if(/^(.+)\.md$/.test(e.name)){if(this.form.title)return;this.form.title=RegExp.$1}else this.$message.error("只能上传 .md 文件"),a.pop()},beforeRemove(){this.form.title=""},md_upload_success(e){if(e.code)return this.$message.error("上传md失败，请检查后端报错");this.form.md=e.url,this.imageUrl?this.$refs.imgForm.submit():this.submit()},coverChange(e,a){if("ready"!==e.status)return;const t=/^image\/(jpeg|png)$/.test(e.raw.type),r=e.raw.size/1024/1024<2;t||this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),r||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&r?this.imageUrl=URL.createObjectURL(e.raw):(this.imageUrl="",a.pop())},cover_upload_success(e){if(e.code)return this.$message.error("上传封面失败，请检查后端报错");this.form.cover=e.url,this.submit()}}};const D=(0,n.Z)(S,[["render",x],["__scopeId","data-v-f6d8d5f4"]]);var A=D;const L={id:"ArticleManger"},M=(0,r.Uk)("点击上传md"),j={class:"cover"},P=(0,r.Uk)("重传封面"),R=(0,r.Uk)("修改 "),z=(0,r.Uk)("删除 ");function T(e,a,t,l,s,i){const o=(0,r.up)("el-input"),d=(0,r.up)("el-table-column"),u=(0,r.up)("el-button"),m=(0,r.up)("el-upload"),n=(0,r.up)("el-image"),c=(0,r.up)("el-table"),p=(0,r.up)("el-pagination");return(0,r.wg)(),(0,r.iD)("div",L,[(0,r.Wm)(o,{class:"search",placeholder:"请输入搜索内容","prefix-icon":"el-icon-search",onInput:i.handleSearch,modelValue:s.searchTxt,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchTxt=e)},null,8,["onInput","modelValue"]),(0,r.Wm)(c,{data:s.articleData,border:"",style:{width:"100%"}},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"标题"},{default:(0,r.w5)((e=>[(0,r.Wm)(o,{modelValue:e.row.title,"onUpdate:modelValue":a=>e.row.title=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,r.Wm)(d,{label:"描述"},{default:(0,r.w5)((e=>[(0,r.Wm)(o,{modelValue:e.row.des,"onUpdate:modelValue":a=>e.row.des=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,r.Wm)(d,{label:"重新上传md"},{default:(0,r.w5)((a=>[(0,r.Wm)(m,{class:"upload-demo",action:`${e.baseURL}/adminServer/article/md`,"on-success":function(e){i.md_upload_success(e,a.row._id)},"before-upload":i.md_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{size:"small",type:"success"},{default:(0,r.w5)((()=>[M])),_:1})])),_:2},1032,["action","on-success","before-upload"])])),_:1}),(0,r.Wm)(d,{label:"重新上传封面图"},{default:(0,r.w5)((a=>[(0,r._)("div",j,[(0,r.Wm)(n,{style:{width:"50px",height:"50px"},src:`${e.baseURL}${a.row.cover}`,"preview-src-list":[`${e.baseURL}${a.row.cover}`]},null,8,["src","preview-src-list"]),(0,r.Wm)(m,{class:"upload-demo",action:`${e.baseURL}/adminServer/article/cover`,"on-success":function(e){i.cover_upload_success(e,a.row._id)},"before-upload":i.cover_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{size:"small",type:"warning"},{default:(0,r.w5)((()=>[P])),_:1})])),_:2},1032,["action","on-success","before-upload"])])])),_:1}),(0,r.Wm)(d,{fixed:"right",label:"操作"},{default:(0,r.w5)((e=>[(0,r.Wm)(u,{type:"primary",onClick:a=>i.update(e.row._id,{title:e.row.title,des:e.row.des}),size:"small"},{default:(0,r.w5)((()=>[R])),_:2},1032,["onClick"]),(0,r.Wm)(u,{type:"danger",onClick:a=>i.deleteArticle(e.row._id),size:"small"},{default:(0,r.w5)((()=>[z])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),s.display?((0,r.wg)(),(0,r.j4)(p,{key:0,background:"",layout:"sizes,prev,pager,next,jumper,->,slot, total",total:s.total,"page-size":s.query.perPage,"onUpdate:page-size":a[1]||(a[1]=e=>s.query.perPage=e),"current-page":s.query.page,"onUpdate:current-page":a[2]||(a[2]=e=>s.query.page=e),onCurrentChange:i.getArticles,onSizeChange:i.getArticles,"page-sizes":[2,5,10,20,30]},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])):(0,r.kq)("",!0)])}t(26699);var F={name:"ArticleManger",data(){return{articleData:[],AllArticleData:[],searchTxt:"",timer:null,total:0,display:!0,query:{page:1,perPage:5}}},methods:{handleSearch(){clearTimeout(this.timer),this.timer=setTimeout((()=>{let e=this.searchTxt.trim();if(!e)return this.articleData=this.AllArticleData;let a=[];this.AllArticleData.forEach((t=>{(t.title.includes(e)||t.des.includes(e))&&a.push(t)})),this.articleData=a}),500)},async getArticles(){let{data:e}=await this.$axios({method:"get",url:"/get/article",params:this.query});if(e.code)return this.$message.error(e.msg);this.AllArticleData=e.data,this.total=e.total,0==this.total&&(this.display=!1),this.handleSearch()},async update(e,a){let{data:t}=await this.$axios({method:"POST",url:"/adminServer/article/update",data:{id:e,doc:a}});if(t.code)return this.$message.error(t.msg);this.$message.success("更新成功"),await this.getArticles()},md_before_upload(e){let a=/\.md$/.test(e.name);return a||this.$message.error("请上传md文件"),a},md_upload_success(e,a){if(e.code)return this.$message.error(e.msg);this.update(a,{md:e.url})},cover_before_upload(e){const a=/^image\/(jpeg|png)$/.test(e.type),t=e.size/1024/1024<2;return a||this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),t||this.$message.error("上传头像图片大小不能超过 2MB!"),a&&t},cover_upload_success(e,a){if(e.code)return this.$message.error(e.msg);this.update(a,{cover:e.url})},async deleteArticle(e){let{data:a}=await this.$axios({method:"DELETE",url:"/adminServer/article/delete",data:{id:e}});if(a.code)return this.$message.error(a.msg);this.$message.success("删除完成"),await this.getArticles()}},created(){this.getArticles()}};const G=(0,n.Z)(F,[["render",T],["__scopeId","data-v-049a6a0b"]]);var I=G;const O={id:"ContactMsg"};function E(e,a,t,l,s,i){const o=(0,r.up)("el-table-column"),d=(0,r.up)("el-switch"),u=(0,r.up)("el-table");return(0,r.wg)(),(0,r.iD)("div",O,[(0,r.Wm)(u,{data:s.contactData,border:"",style:{width:"100%"}},{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.j4)(o,{prop:"date",label:"日期",key:s.contactData.date,formatter:i.dateFormat,width:"150px",align:"center"},null,8,["formatter"])),(0,r.Wm)(o,{prop:"name",label:"Name",align:"center"}),(0,r.Wm)(o,{prop:"email",label:"Email"}),(0,r.Wm)(o,{prop:"subject",label:"Subject"}),(0,r.Wm)(o,{prop:"message",label:"Message"}),(0,r.Wm)(o,{width:"170px",label:"是否处理"},{default:(0,r.w5)((e=>[(0,r.Wm)(d,{style:{display:"block"},modelValue:e.row.read,"onUpdate:modelValue":a=>e.row.read=a,"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"已处理","inactive-text":"未处理",onChange:a=>i.switchHandle(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1})])),_:1},8,["data"])])}var q={name:"ContactMsg",data(){return{contactData:[]}},methods:{dateFormat:function(e,a){let r=e[a.property];if(void 0==r)return"";let l=t(36797);return l(r).format("YYYY-MM-DD HH:mm:ss")},async getContactData(){let{data:e}=await this.$axios({method:"GET",url:"/adminServer/contact"});if(e.code)return this.$message.error(e.msg);this.contactData=e.data},async switchHandle(e){let{data:a}=await this.$axios({method:"POST",url:"/adminServer/contact/read",data:{id:e._id,read:e.read}});if(a.code)return this.$message.error(a.msg)}},created(){this.getContactData()}};const N=(0,n.Z)(q,[["render",E]]);var Z=N;const Y=e=>((0,r.dD)("data-v-879e2d9c"),e=e(),(0,r.Cn)(),e),H={class:"swiperAdd"},J={class:"swiperPhoto"},B=Y((()=>(0,r._)("i",{class:"el-icon-upload"},null,-1))),K=Y((()=>(0,r._)("div",{class:"el-upload__text"},[(0,r.Uk)("将.jpj或者png文件拖到此处，或"),(0,r._)("em",null,"点击上传")],-1))),Q={class:"reviseSwiper"},X=(0,r.Uk)("确认上传");function ee(e,a,t,l,s,i){const o=(0,r.up)("el-upload"),d=(0,r.up)("el-form-item"),u=(0,r.up)("el-form"),m=(0,r.up)("el-button");return(0,r.wg)(),(0,r.iD)("div",H,[(0,r._)("div",J,[(0,r.Wm)(u,{model:s.form},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"轮播图上传：","label-width":"150px"},{default:(0,r.w5)((()=>[(0,r.Wm)(o,{class:"upload-demo",drag:"",action:`${e.baseURL}/adminServer/swiper/swiperAdd`,"auto-upload":!1,"on-change":i.fileChange,limit:1,ref:"swiperForm","on-success":i.swiper_upload_success,"with-credentials":!0},{default:(0,r.w5)((()=>[B,K])),_:1},8,["action","on-change","on-success"])])),_:1})])),_:1},8,["model"])]),(0,r._)("div",Q,[(0,r.Wm)(m,{type:"primary",onClick:i.submitSwiper},{default:(0,r.w5)((()=>[X])),_:1},8,["onClick"])])])}var ae={name:"SwiperAdd",data(){return{form:{swiper:""}}},methods:{async submit(){let{data:e}=await this.$axios({method:"POST",url:"/adminServer/swiper/add",data:this.form});if(e.code)return this.$message.error(e.msg);await this.$router.push("/")},fileChange(e,a){"ready"===e.status&&(/^(\s|\S)+(jpg|png|JPG|PNG)+$/.test(e.name)||(this.$message.error("只能上传.png 或. jpj文件"),a.pop()))},submitSwiper(){this.$refs.swiperForm.submit()},swiper_upload_success(e){if(e.code)return this.$message.error("上传轮播图失败，请检查后端报错");this.form.swiper=e.url,this.submit()}}};const te=(0,n.Z)(ae,[["render",ee],["__scopeId","data-v-879e2d9c"]]);var re=te;const le=e=>((0,r.dD)("data-v-4f87bb05"),e=e(),(0,r.Cn)(),e),se={class:"swiper"},ie=le((()=>(0,r._)("i",{class:"el-icon-upload"},null,-1))),oe=le((()=>(0,r._)("div",{class:"el-upload__text"},[(0,r.Uk)("将.jpj或者png文件拖到此处，或"),(0,r._)("em",null,"点击上传")],-1))),de=(0,r.Uk)("删除 ");function ue(e,a,t,l,s,i){const o=(0,r.up)("el-image"),d=(0,r.up)("el-upload"),u=(0,r.up)("el-table-column"),m=(0,r.up)("el-button"),n=(0,r.up)("el-table");return(0,r.wg)(),(0,r.j4)(n,{data:s.MangerSwiper,border:"",style:{width:"100%",height:"100%"}},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{label:"重新上传轮播图",width:"770"},{default:(0,r.w5)((a=>[(0,r._)("div",se,[(0,r.Wm)(o,{style:{width:"350px",height:"150px"},src:`${e.baseURL}${a.row.swiper}`,"preview-src-list":[`${e.baseURL}${a.row.swiper}`]},null,8,["src","preview-src-list"]),(0,r.Wm)(d,{class:"upload-demo",drag:"",action:`${e.baseURL}/adminServer/swiper/swiperAdd`,"on-change":i.swiper_before_upload,limit:1,ref:"swiperForm","on-success":function(e){i.swiper_upload_success(e,a.row._id)},"with-credentials":!0},{default:(0,r.w5)((()=>[ie,oe])),_:2},1032,["action","on-change","on-success"])])])),_:1}),(0,r.Wm)(u,{fixed:"right",label:"操作"},{default:(0,r.w5)((e=>[(0,r.Wm)(m,{type:"danger",onClick:a=>i.deleteSwiper(e.row._id),size:"small"},{default:(0,r.w5)((()=>[de])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])}var me={name:"SwiperManger",data(){return{MangerSwiper:[]}},methods:{async getMangerSwiper(){let{data:e}=await this.$axios({method:"GET",url:"/get/swiper"});this.MangerSwiper=e.data},async swiperUpdate(e,a){let{data:t}=await this.$axios({method:"POST",url:"/adminServer/swiper/update",data:{id:e,doc:a}});if(t.code)return this.$message.error(t.msg);this.$message.success("更新成功"),await this.getMangerSwiper()},swiper_before_upload(e,a){/^(\s|\S)+(jpg|png|JPG|PNG)+$/.test(e.name)||(this.$message.error("只能上传.png 或. jpj文件"),a.pop())},swiper_upload_success(e,a){if(e.code)return this.$message.error(e.msg);this.swiperUpdate(a,{swiper:e.url})},async deleteSwiper(e){let{data:a}=await this.$axios({method:"POST",url:"/adminServer/swiper/delete",data:{id:e}});if(a.code)return this.$message.error(a.msg);this.$message.success("删除成功"),await this.getMangerSwiper()}},created(){this.getMangerSwiper()}};const ne=(0,n.Z)(me,[["render",ue],["__scopeId","data-v-4f87bb05"]]);var ce=ne;const pe=e=>((0,r.dD)("data-v-3cc7be56"),e=e(),(0,r.Cn)(),e),he={class:"videoAdd"},ge={class:"videoPhoto"},we=pe((()=>(0,r._)("i",{class:"el-icon-upload"},null,-1))),fe=pe((()=>(0,r._)("div",{class:"el-upload__text"},[(0,r.Uk)("将视频格式文件拖到此处，或"),(0,r._)("em",null,"点击上传")],-1))),ve={key:1,class:"el-icon-plus avatar-uploader-icon"},_e={class:"reviseVideo"},be=(0,r.Uk)("确认上传");function $e(e,a,t,l,s,i){const o=(0,r.up)("el-input"),d=(0,r.up)("el-form-item"),u=(0,r.up)("el-upload"),m=(0,r.up)("el-form"),n=(0,r.up)("el-button");return(0,r.wg)(),(0,r.iD)("div",he,[(0,r._)("div",ge,[(0,r.Wm)(m,{model:s.form},{default:(0,r.w5)((()=>[(0,r.Wm)(d,{label:"标题：","label-width":"150px"},{default:(0,r.w5)((()=>[(0,r.Wm)(o,{modelValue:s.form.title,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.title=e),placeholder:"可通过上传视频文件自动获取文件名"},null,8,["modelValue"])])),_:1}),(0,r.Wm)(d,{label:"视频上传：","label-width":"150px"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{class:"upload-demo",drag:"",action:`${e.baseURL}/adminServer/video/videoAdd`,"auto-upload":!1,"on-change":i.fileChange,limit:1,ref:"videoForm","on-success":i.video_upload_success,"with-credentials":!0},{default:(0,r.w5)((()=>[we,fe])),_:1},8,["action","on-change","on-success"])])),_:1}),(0,r.Wm)(d,{label:"封面图上传：","label-width":"150px"},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{class:"avatar-uploader",action:`${e.baseURL}/adminServer/video/videoCover`,"show-file-list":!1,"on-change":i.videoCoverChange,"on-success":i.videoCover_upload_success,"auto-upload":!1,ref:"imgForm","with-credentials":!0},{default:(0,r.w5)((()=>[s.imageUrl?((0,r.wg)(),(0,r.iD)("div",{key:0,class:"avatar",style:(0,$.j5)({backgroundImage:`url(${s.imageUrl})`})},null,4)):((0,r.wg)(),(0,r.iD)("i",ve))])),_:1},8,["action","on-change","on-success"])])),_:1})])),_:1},8,["model"])]),(0,r._)("div",_e,[(0,r.Wm)(n,{type:"primary",onClick:i.submitVideo},{default:(0,r.w5)((()=>[be])),_:1},8,["onClick"])])])}var We={name:"VideoAdd",data(){return{form:{title:"",video:"",videoCover:""},imageUrl:""}},methods:{async submit(){let{data:e}=await this.$axios({method:"POST",url:"/adminServer/video/add",data:this.form});if(e.code)return this.$message.error(e.msg);await this.$router.push("/Video")},fileChange(e,a){if("ready"===e.status)if(/(.*)\.(mp4|rmvb|avi|ts|flv|mov|3gb|m3u8)$/.test(e.name)){if(this.form.title)return;this.form.title=RegExp.$1}else this.$message.error("只能上传.mp4 .avi .flv .rmvb .mov .m3u8 或.3gb格式的文件"),a.pop()},submitVideo(){this.$refs.videoForm.submit()},beforeRemove(){this.form.title=""},video_upload_success(e){if(e.code)return this.$message.error("上传视频失败，请检查后端报错");this.form.video=e.url,this.imageUrl?this.$refs.imgForm.submit():this.submit()},videoCoverChange(e,a){if("ready"!==e.status)return;const t=/^image\/(jpeg|png)$/.test(e.raw.type),r=e.raw.size/1024/1024<2;t||this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),r||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&r?this.imageUrl=URL.createObjectURL(e.raw):(this.imageUrl="",a.pop())},videoCover_upload_success(e){if(e.code)return this.$message.error("上传封面失败，请检查后端报错");this.form.videoCover=e.url,this.submit()}}};const ye=(0,n.Z)(We,[["render",$e],["__scopeId","data-v-3cc7be56"]]);var ke=ye;const Ue={class:"mr30 mt10"},Ve=["poster"],Ce=["src"],xe={style:{"margin-top":"10px"}},Se=(0,r.Uk)("更新视频"),De={class:"videoCover"},Ae=(0,r.Uk)("重传封面"),Le={style:{"margin-bottom":"10px"}},Me=(0,r.Uk)("修改 "),je=(0,r.Uk)("删除 ");function Pe(e,a,t,l,s,i){const o=(0,r.up)("el-table-column"),d=(0,r.up)("el-input"),u=(0,r.up)("el-button"),m=(0,r.up)("el-upload"),n=(0,r.up)("el-image"),c=(0,r.up)("el-table");return(0,r.wg)(),(0,r.j4)(c,{data:s.MangerVideo,border:"",style:{width:"100%",height:"100%"}},{default:(0,r.w5)((()=>[((0,r.wg)(),(0,r.j4)(o,{prop:"date",label:"发布日期",key:s.MangerVideo.date,formatter:i.dateFormat,width:"93px",align:"center"},null,8,["formatter"])),(0,r.Wm)(o,{label:"标题",width:"100px"},{default:(0,r.w5)((e=>[(0,r.Wm)(d,{modelValue:e.row.title,"onUpdate:modelValue":a=>e.row.title=a},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,r.Wm)(o,{label:"重新上传视频",align:"center"},{default:(0,r.w5)((a=>[(0,r._)("div",Ue,[(0,r._)("video",{ref:"video",class:"video-js vjs-default-skin vjs-big-play-centered mt10",controls:"controls",poster:`${e.baseURL}${a.row.videoCover}`},[(0,r._)("source",{src:`${e.baseURL}${a.row.video}`,type:"video/mp4"},null,8,Ce)],8,Ve)]),(0,r.Wm)(m,{class:"upload-demo",action:`${e.baseURL}/adminServer/video/videoAdd`,"on-success":function(e){i.video_upload_success(e,a.row._id)},"before-upload":i.video_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:(0,r.w5)((()=>[(0,r._)("div",xe,[(0,r.Wm)(u,{size:"small",type:"success"},{default:(0,r.w5)((()=>[Se])),_:1})])])),_:2},1032,["action","on-success","before-upload"])])),_:1}),(0,r.Wm)(o,{label:"重新上传封面图",width:"255px"},{default:(0,r.w5)((a=>[(0,r._)("div",De,[(0,r.Wm)(n,{style:{width:"150px",height:"100px"},src:`${e.baseURL}${a.row.videoCover}`,"preview-src-list":[`${e.baseURL}${a.row.videoCover}`]},null,8,["src","preview-src-list"]),(0,r.Wm)(m,{class:"upload-demo",action:`${e.baseURL}/adminServer/video/videoCover`,"on-success":function(e){i.videoCover_upload_success(e,a.row._id)},"before-upload":i.videoCover_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:(0,r.w5)((()=>[(0,r.Wm)(u,{size:"small",type:"warning"},{default:(0,r.w5)((()=>[Ae])),_:1})])),_:2},1032,["action","on-success","before-upload"])])])),_:1}),(0,r.Wm)(o,{fixed:"right",label:"操作",width:"80px"},{default:(0,r.w5)((e=>[(0,r._)("div",Le,[(0,r.Wm)(u,{type:"primary",onClick:a=>i.update(e.row._id,{title:e.row.title}),size:"small"},{default:(0,r.w5)((()=>[Me])),_:2},1032,["onClick"])]),(0,r._)("div",null,[(0,r.Wm)(u,{type:"danger",onClick:a=>i.deleteVideo(e.row._id),size:"small"},{default:(0,r.w5)((()=>[je])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"])}var Re={name:"VideoManger",data(){return{MangerVideo:[]}},methods:{dateFormat:function(e,a){let r=e[a.property];if(void 0==r)return"";let l=t(36797);return l(r).format("YYYY-MM-DD HH:mm:ss")},async getVideo(){let{data:e}=await this.$axios({method:"get",url:"/get/video"});if(e.code)return this.$message.error(e.msg);this.MangerVideo=e.data},async update(e,a){let{data:t}=await this.$axios({method:"POST",url:"/adminServer/video/update",data:{id:e,doc:a}});if(t.code)return this.$message.error(t.msg);this.$message.success("更新成功"),await this.getVideo()},video_before_upload(e){let a=/(.*)\.(mp4|rmvb|avi|ts|flv|mov|3gb)$/.test(e.name);return a||this.$message.error("请上传视频文件"),a},video_upload_success(e,a){if(e.code)return this.$message.error(e.msg);this.update(a,{video:e.url})},videoCover_before_upload(e){const a=/^image\/(jpeg|png)$/.test(e.type),t=e.size/1024/1024<2;return a||this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),t||this.$message.error("上传头像图片大小不能超过 2MB!"),a&&t},videoCover_upload_success(e,a){if(e.code)return this.$message.error(e.msg);this.update(a,{videoCover:e.url})},async deleteVideo(e){let{data:a}=await this.$axios({method:"DELETE",url:"/adminServer/video/delete",data:{id:e}});if(a.code)return this.$message.error(a.msg);this.$message.success("视频已删除完成"),await this.getVideo()}},created(){this.getVideo()}};const ze=(0,n.Z)(Re,[["render",Pe],["__scopeId","data-v-9ce48708"]]);var Te=ze,Fe={name:"Admin",data(){return{activeName:"second"}},components:{LinkAdd:p,LinkManger:b,ArticleAdd:A,ArticleManger:I,ContactMsg:Z,SwiperAdd:re,SwiperManger:ce,VideoAdd:ke,VideoManger:Te},computed:{...(0,u.rn)(["userInfo"])},watch:{userInfo(){this.check()}},methods:{async check(){let{data:e}=await this.$axios({method:"POST",url:"/adminServer/check"});e.code&&(await this.$router.replace("/"),this.$message.error("请以管理员账号登录admin页面"))}},async created(){await this.check()}};const Ge=(0,n.Z)(Fe,[["render",s],["__scopeId","data-v-6acfc400"]]);var Ie=Ge}}]);
//# sourceMappingURL=42.41890d17.js.map
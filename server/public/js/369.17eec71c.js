"use strict";(self["webpackChunkmyblog"]=self["webpackChunkmyblog"]||[]).push([[369],{29369:function(e,i,s){s.r(i),s.d(i,{default:function(){return T}});s(26699);var t=s(73396),l=s(49242),r=s(87139);const a=e=>((0,t.dD)("data-v-fb377386"),e=e(),(0,t.Cn)(),e),o={id:"Message"},n={class:"a1"},u=a((()=>(0,t._)("h2",null,"留言板",-1))),c=a((()=>(0,t._)("p",{class:"des"},"请文明发言，禁止广告。不然拉黑了嗷\\(^o^)/~",-1))),d={class:"btn"},h={class:"left"},m={key:0,class:"emoji"},g=["onClick"],p=(0,t.Uk)("发表 "),f={class:"a2"},k={class:"parent"},_={class:"right"},y={class:"name-time"},w={class:"message"},$={class:"like-reply"},C=["onClick"],x=["onClick"],v={class:"right"},S={class:"name-time"},b={class:"message"},I={class:"like-reply"},U=["onClick"],D=["onClick"],j=(0,t.Uk)("提交 ");function R(e,i,s,a,R,z){const E=(0,t.up)("el-input"),L=(0,t.up)("el-button");return(0,t.wg)(),(0,t.iD)("div",o,[(0,t._)("article",n,[u,c,(0,t.Wm)(E,{type:"textarea",rows:2,placeholder:"请输入内容",maxlength:"100","show-word-limit":"",modelValue:R.textarea,"onUpdate:modelValue":i[0]||(i[0]=e=>R.textarea=e)},null,8,["modelValue"]),(0,t._)("div",d,[(0,t._)("div",h,[(0,t._)("i",{class:"iconfont icon-biaoqing",onClick:i[1]||(i[1]=(0,l.iM)(((...e)=>z.showEmoji&&z.showEmoji(...e)),["stop"]))}),R.ifShowEmoji?((0,t.wg)(),(0,t.iD)("div",m,[(0,t._)("ul",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(R.emoji,(e=>((0,t.wg)(),(0,t.iD)("li",{key:e,onClick:(0,l.iM)((i=>z.clickEmoji(e)),["stop"])},(0,r.zw)(e),9,g)))),128))])])):(0,t.kq)("",!0)]),(0,t.Wm)(L,{type:"primary",size:"mini",onClick:z.submit},{default:(0,t.w5)((()=>[p])),_:1},8,["onClick"])])]),(0,t._)("article",f,[(0,t._)("ul",null,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(R.msgList,(i=>((0,t.wg)(),(0,t.iD)("li",{key:i._id},[(0,t._)("div",k,[(0,t._)("div",{class:"left",style:(0,r.j5)({backgroundImage:`url(${e.baseURL}${i.author.photo})`})},null,4),(0,t._)("div",_,[(0,t._)("div",y,[(0,t._)("span",null,(0,r.zw)(i.author.user),1),(0,t._)("span",null,(0,r.zw)(z.formatDate(i.date)),1)]),(0,t._)("div",w,(0,r.zw)(i.text),1),(0,t._)("div",$,[(0,t._)("i",{class:(0,r.C_)(["like iconfont icon-xinaixin",{isLike:e.userInfo._id&&i.likes.includes(e.userInfo._id)}]),onClick:e=>z.parentLikeClick(i._id)},null,10,C),(0,t._)("span",null,(0,r.zw)(i.likes.length),1),(0,t._)("i",{class:"reply iconfont icon-huifu",onClick:e=>z.parentReplyClick(i)},null,8,x)])])]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(i.children,((s,l)=>((0,t.wg)(),(0,t.iD)("div",{class:"child",key:s._id},[(0,t._)("div",{class:"left",style:(0,r.j5)({backgroundImage:`url(${e.baseURL}${s.author.photo})`})},null,4),(0,t._)("div",v,[(0,t._)("div",S,[(0,t._)("span",null,(0,r.zw)(s.author.user),1),(0,t._)("span",null,(0,r.zw)(z.formatDate(s.date)),1)]),(0,t._)("div",b,[(0,t._)("span",null,"@"+(0,r.zw)(s.replyUser.user),1),(0,t.Uk)((0,r.zw)(s.text),1)]),(0,t._)("div",I,[(0,t._)("i",{class:(0,r.C_)(["like iconfont icon-xinaixin",{isLike:e.userInfo._id&&s.likes.includes(e.userInfo._id)}]),onClick:e=>z.childLikeClick(i._id,s._id,l)},null,10,U),(0,t._)("span",null,(0,r.zw)(s.likes.length),1),(0,t._)("i",{class:"reply iconfont icon-huifu",onClick:e=>z.childReplyClick(i,s)},null,8,D)])])])))),128)),(0,t._)("div",{class:(0,r.C_)(["replyInput",{show:i.ifShowReply}])},[(0,t.Wm)(E,{size:"mini",placeholder:`@${i.replyUser.user}`,modelValue:i.replyTxt,"onUpdate:modelValue":e=>i.replyTxt=e},null,8,["placeholder","modelValue","onUpdate:modelValue"]),(0,t.Wm)(L,{type:"primary",size:"mini",onClick:e=>z.replySubmit(i)},{default:(0,t.w5)((()=>[j])),_:2},1032,["onClick"])],2)])))),128))])])])}var z=s(20065),E={name:"Message",data(){return{textarea:"",ifShowEmoji:!1,emoji:["😃","😁","😂","😊","🙃","🥰","😘","🤭","🤔","😏","😵","😟","🙁","😳","😰","😭","😖","😡","😠","😈","🤡","☠️","👻","🙈","🙉","❤️","💖","💢","💣","💤","👋","👍","👌","🤞","🤟","🤙","👊","🖕","🤝","🙏","🙅","🙅‍♂️","👨‍✈️","👩‍✈️","👷","👷‍♀️","🤦","🤦‍♂️","👴","🧓","🐴","🐮","🐖","🐑","🐓","🦚","🐲","🐳","🐟","🐌"],msgList:[]}},computed:{...(0,z.rn)(["userInfo"])},methods:{showEmoji(){this.ifShowEmoji=!this.ifShowEmoji},clickEmoji(e){this.textarea.length>98||(this.textarea+=e)},async submit(){if(!this.userInfo.user)return this.$message.error("请先登录");let e=this.textarea.trim();if(!e)return this.$message.error("请输入留言内容");let{data:i}=await this.$axios({method:"POST",url:"/msg/submit",data:{val:e}});if(i.code)return this.$message.error(i.msg);this.$message.success("留言成功"),this.textarea="",this.getMsg()},async getMsg(){let{data:e}=await this.$axios({method:"GET",url:"/get/msg"}),i=e.data;i.forEach((e=>{e.ifShowReply=!1,e.replyTxt="",e.replyUser=e.author})),this.msgList=i},formatDate(e){let i=new Date(e),s=i.getFullYear(),t=i.getMonth()+1,l=i.getDate(),r=i.getHours(),a=i.getMinutes(),o=i.getSeconds();return t=(t<10?"0":"")+t,l=(l<10?"0":"")+l,r=(r<10?"0":"")+r,a=(a<10?"0":"")+a,o=(o<10?"0":"")+o,`${s}-${t}-${l} ${r}:${a}:${o}`},async parentLikeClick(e){if(!this.userInfo.user)return this.$message.error("请先登录");let{data:i}=await this.$axios({method:"POST",url:"/msg/like/parent",data:{id:e}});if(i.code)return this.$message.error(i.msg);this.getMsg()},async childLikeClick(e,i,s){if(!this.userInfo.user)return this.$message.error("请先登录");let{data:t}=await this.$axios({method:"POST",url:"/msg/like/child",data:{pID:e,cID:i,cIndex:s}});if(t.code)return this.$message.error(t.msg);this.getMsg()},async replySubmit(e){if(!this.userInfo.user)return this.$message.error("请先登录");let i=e.replyTxt.trim();if(!i)return this.$message.error("请输入回复内容");if(i.length>100)return this.$message.error("回复字数不能超过100");let{data:s}=await this.$axios({method:"POST",url:"/msg/reply/submit",data:{id:e._id,text:i,replyUser:e.replyUser._id}});if(s.code)return this.$message.error(s.msg);this.$message.success("回复成功"),await this.getMsg()},parentReplyClick(e){if(!this.userInfo.user)return this.$message.error("请先登录");e.author._id!==e.replyUser._id?e.ifShowReply=!0:e.ifShowReply=!e.ifShowReply,e.replyUser=e.author},childReplyClick(e,i){if(!this.userInfo.user)return this.$message.error("请先登录");i.author._id!==e.replyUser._id?e.ifShowReply=!0:e.ifShowReply=!e.ifShowReply,e.replyUser=i.author}},created(){this.getMsg()},mounted(){document.addEventListener("click",(()=>{this.ifShowEmoji=!1}))}},L=s(40089);const M=(0,L.Z)(E,[["render",R],["__scopeId","data-v-fb377386"]]);var T=M}}]);
//# sourceMappingURL=369.17eec71c.js.map
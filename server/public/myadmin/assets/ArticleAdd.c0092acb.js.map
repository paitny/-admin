{"version":3,"file":"ArticleAdd.c0092acb.js","sources":["../../src/views/ArticleManage/ArticleAdd.vue"],"sourcesContent":["<template>\r\n  <div id=\"ArticleAdd\">\r\n    <el-form\r\n        :model=\"form\"\r\n        status-icon\r\n        ref=\"ruleForm\"\r\n        label-width=\"100px\"\r\n    >\r\n      <el-form-item label=\"标题：\" label-width=\"100px\">\r\n        <el-input\r\n            v-model=\"form.title\"\r\n            placeholder=\"可通过上传 md 自动获取文件名\"\r\n        ></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"描述：\" label-width=\"100px\">\r\n        <el-input type=\"textarea\" v-model=\"form.des\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label=\"md上传：\" label-width=\"100px\">\r\n        <el-upload\r\n            class=\"upload-demo\"\r\n            drag\r\n            :action=\"`${baseURL}/adminServer/article/md`\"\r\n            :auto-upload=\"false\"\r\n            :on-change=\"fileChange\"\r\n            :on-success=\"md_upload_success\"\r\n            :before-remove=\"beforeRemove\"\r\n            :limit=\"1\"\r\n            ref=\"mdForm\"\r\n            :with-credentials=\"true\"\r\n        >\r\n          <i class=\"el-icon-upload\"><el-icon class=\"el-icon--upload\"><upload-filled /></el-icon></i>\r\n          <div class=\"el-upload__text\">将.md文件拖到此处，或<em>点击上传</em></div>\r\n        </el-upload>\r\n      </el-form-item>\r\n      <el-form-item label=\"封面图上传：\" label-width=\"100px\">\r\n        <el-upload\r\n            class=\"avatar-uploader\"\r\n            :action=\"`${baseURL}/adminServer/article/cover`\"\r\n            :show-file-list=\"false\"\r\n            :on-change=\"coverChange\"\r\n            :on-success=\"cover_upload_success\"\r\n            :auto-upload=\"false\"\r\n            ref=\"imgForm\"\r\n            :with-credentials=\"true\"\r\n        >\r\n          <div\r\n              v-if=\"imageUrl\"\r\n              class=\"avatar\"\r\n              :style=\"{\r\n              backgroundImage: `url(${imageUrl})`\r\n            }\"\r\n          >\r\n          </div>\r\n          <i v-else class=\"el-icon-plus avatar-uploader-icon\"><el-icon><Plus /></el-icon></i>\r\n        </el-upload>\r\n      </el-form-item>\r\n      <el-form-item label-width=\"100px\">\r\n        <el-button type=\"primary\" @click=\"submitForm\" size=\"large\">确认发表</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n  <router-view/>\r\n</template>\r\n\r\n<script >\r\nexport default {\r\n  name: \"ArticleAdd\",\r\n  data() {\r\n    return {\r\n      form: {\r\n        title: \"\",\r\n        des: \"\",\r\n        md: \"\",\r\n        cover: \"\"\r\n      },\r\n      imageUrl: \"\"\r\n    }\r\n  },\r\n  methods: {\r\n    //发表按钮点击\r\n    submitForm() {\r\n      //从上传md开始，后续的上传在对应的回调里面完成\r\n      this.$refs.mdForm.submit()\r\n    },\r\n\r\n    //文章发表\r\n    async submit() {\r\n      let {data} = await this.$axios({\r\n        method: \"POST\",\r\n        url: \"/adminServer/article/add\",\r\n        data: this.form\r\n      })\r\n\r\n      if (data.code) {\r\n        return this.$message.error(data.msg)\r\n      }\r\n\r\n      //跳转到对应的文章页面\r\n      await this.$router.push(\"/articleManager\")\r\n    },\r\n\r\n    //添加md文件的各种检测\r\n    fileChange(file, fileList) {\r\n      if (file.status !== 'ready') return\r\n      //简单判断是否是.md文件\r\n      if (/^(.+)\\.md$/.test(file.name)) {\r\n        //当没有输入title的时候，获取名字填充到title\r\n        if (this.form.title) return\r\n        this.form.title = RegExp.$1\r\n      } else {\r\n        //提示并阻止文件添加\r\n        this.$message.error(\"只能上传 .md 文件\")\r\n        fileList.pop()\r\n      }\r\n    },\r\n\r\n    //删除md文件之前的钩子\r\n    beforeRemove() {\r\n      this.form.title = \"\"\r\n    },\r\n\r\n    //md上传成功的钩子\r\n    md_upload_success(res) {\r\n      //md上传失败\r\n      if (res.code) {\r\n        return this.$message.error(\"上传md失败，请检查后端报错\")\r\n      }\r\n\r\n      //md上传成功\r\n      this.form.md = res.url\r\n      //判断是否有封面图\r\n      if (this.imageUrl) {\r\n        //有封面图，触发封面图的上传\r\n        this.$refs.imgForm.submit()\r\n      } else {\r\n        //没有封面图，直接发表文章\r\n        this.submit()\r\n      }\r\n    },\r\n\r\n    //添加封面的钩子\r\n    coverChange(file, fileList) {\r\n      if (file.status !== 'ready') return\r\n\r\n      const isJPG = /^image\\/(jpeg|png)$/.test(file.raw.type);\r\n      const isLt2M = file.raw.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      if (isJPG && isLt2M) {\r\n        this.imageUrl = URL.createObjectURL(file.raw);\r\n      } else {\r\n        this.imageUrl = \"\"\r\n        fileList.pop()\r\n      }\r\n    },\r\n\r\n    //封面上传成功\r\n    cover_upload_success(res) {\r\n      if (res.code) {\r\n        return this.$message.error(\"上传封面失败，请检查后端报错\")\r\n      }\r\n      this.form.cover = res.url\r\n      this.submit()\r\n    }\r\n\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n#ArticleAdd {\r\n  z-index: 999;\r\n  :deep(.avatar-uploader .el-upload)  {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n\r\n  }\r\n\r\n  :deep(.avatar-uploader .el-upload:hover)  {\r\n    border-color: #409EFF;\r\n  }\r\n  :deep(.avatar-uploader-icon) {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 178px;\r\n    height: 178px;\r\n    line-height: 178px;\r\n    text-align: center;\r\n\r\n  }\r\n\r\n  :deep(.avatar) {\r\n    width: 178px;\r\n    height: 178px;\r\n    display: block;\r\n    background: none center center/cover;\r\n  }\r\n  :deep(.el-upload-dragger){\r\n    width: 360px;\r\n\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["_createElementVNode","_createVNode","_createElementBlock","_normalizeStyle","_openBlock"],"mappings":"o7BAiEA,KAAK,GAAU,CACb,KAAM,aACN,MAAO,CACL,MAAO,CACL,KAAM,CACJ,MAAO,GACP,IAAK,GACL,GAAI,GACJ,MAAO,EACR,EACD,SAAU,EACZ,CACD,EACD,QAAS,CAEP,YAAa,CAEX,KAAK,MAAM,OAAO,OAAO,CAC1B,EAGD,KAAM,SAAS,CACb,GAAI,CAAC,QAAQ,KAAM,MAAK,OAAO,CAC7B,OAAQ,OACR,IAAK,2BACL,KAAM,KAAK,KACZ,EAED,GAAI,EAAK,KACP,MAAO,MAAK,SAAS,MAAM,EAAK,GAAG,EAIrC,KAAM,MAAK,QAAQ,KAAK,iBAAiB,CAC1C,EAGD,WAAW,EAAM,EAAU,CACzB,GAAI,EAAK,SAAW,QAEpB,GAAI,aAAa,KAAK,EAAK,IAAI,EAAG,CAEhC,GAAI,KAAK,KAAK,MAAO,OACrB,KAAK,KAAK,MAAQ,OAAO,OAGzB,MAAK,SAAS,MAAM,2CAAa,EACjC,EAAS,IAAI,CAEhB,EAGD,cAAe,CACb,KAAK,KAAK,MAAQ,EACnB,EAGD,kBAAkB,EAAK,CAErB,GAAI,EAAI,KACN,MAAO,MAAK,SAAS,MAAM,4EAAgB,EAI7C,KAAK,KAAK,GAAK,EAAI,IAEnB,AAAI,KAAK,SAEP,KAAK,MAAM,QAAQ,OAAO,EAG1B,KAAK,OAAO,CAEf,EAGD,YAAY,EAAM,EAAU,CAC1B,GAAI,EAAK,SAAW,QAAS,OAE7B,KAAM,GAAQ,sBAAsB,KAAK,EAAK,IAAI,IAAI,EAChD,EAAS,EAAK,IAAI,KAAO,KAAO,KAAO,EAE7C,AAAK,GACH,KAAK,SAAS,MAAM,8EAAuB,EAExC,GACH,KAAK,SAAS,MAAM,+EAAmB,EAEzC,AAAI,GAAS,EACX,KAAK,SAAW,IAAI,gBAAgB,EAAK,GAAG,EAE5C,MAAK,SAAW,GAChB,EAAS,IAAI,EAEhB,EAGD,qBAAqB,EAAK,CACxB,GAAI,EAAI,KACN,MAAO,MAAK,SAAS,MAAM,sFAAgB,EAE7C,KAAK,KAAK,MAAQ,EAAI,IACtB,KAAK,OAAO,CACd,CAEF,CACF,0CA1KO,EAAA,CAAA,GAAG,YAAY,EA6BT,EAAA,CAAA,MAAM,gBAAgB,UACzBA,EAA4D,MAAA,CAAvD,MAAM,mBAAiB,GAAC,2DAAY,EAAAA,EAAa,UAAT,0BAAI,iBAsBvC,MAAM,yCAIyC,0BAAI,6MAxDrEA,EA2DM,MA3DN,EA2DM,CA1DJC,EAyDU,EAAA,CAxDL,MAAO,EAAI,KACZ,cAAA,GACA,IAAI,WACJ,cAAY,oBAEd,IAKe,CALfA,EAKe,EAAA,CALD,MAAM,qBAAM,cAAY,oBACpC,IAGY,CAHZA,EAGY,EAAA,CAFC,WAAA,EAAA,KAAK,MAAL,sBAAA,EAAA,IAAA,GAAA,GAAA,GAAA,EAAA,KAAK,MAAK,GACnB,YAAY,+GAGlBA,EAEe,EAAA,CAFD,MAAM,qBAAM,cAAY,oBACpC,IAAwD,CAAxDA,EAAwD,EAAA,CAA9C,KAAK,WAAoB,WAAA,EAAA,KAAK,IAAL,sBAAA,EAAA,IAAA,GAAA,GAAA,GAAA,EAAA,KAAK,IAAG,mCAE7CA,EAgBe,EAAA,CAhBD,MAAM,uBAAQ,cAAY,oBACtC,IAcY,CAdZA,EAcY,EAAA,CAbR,MAAM,cACN,KAAA,GACC,UAAW,EAAO,iCAClB,cAAa,GACb,YAAW,EAAU,WACrB,aAAY,EAAiB,kBAC7B,gBAAe,EAAY,aAC3B,MAAO,EACR,IAAI,SACH,mBAAkB,eAErB,IAA0F,CAA1FD,EAA0F,IAA1F,EAA0F,CAAhEC,EAA4D,EAAA,CAAnD,MAAM,iBAAiB,EAAA,WAAC,IAAiB,CAAjBA,EAAiB,CAAA,YAC5E,wEAGJA,EAqBe,EAAA,CArBD,MAAM,uCAAS,cAAY,oBACvC,IAmBY,CAnBZA,EAmBY,EAAA,CAlBR,MAAM,kBACL,UAAW,EAAO,oCAClB,iBAAgB,GAChB,YAAW,EAAW,YACtB,aAAY,EAAoB,qBAChC,cAAa,GACd,IAAI,UACH,mBAAkB,eAErB,IAOM,CANI,EAAQ,cADlBC,EAOM,MAAA,OALF,MAAM,SACL,MAAKC,EAAA,wBAA2C,EAAQ,wBAK7DC,KAAAF,EAAmF,IAAnF,EAAmF,CAA/BD,EAA2B,EAAA,KAAA,WAAlB,IAAQ,CAARA,EAAQ,CAAA,mEAGzEA,EAEe,EAAA,CAFD,cAAY,OAAO,EAAA,WAC/B,IAA2E,CAA3EA,EAA2E,EAAA,CAAhE,KAAK,UAAW,QAAO,EAAU,WAAE,KAAK,oBAAQ,IAAI,uDAIrEA,EAAc,CAAA"}
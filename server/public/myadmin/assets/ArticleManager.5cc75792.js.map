{"version":3,"file":"ArticleManager.5cc75792.js","sources":["../../src/views/ArticleManage/ArticleManager.vue"],"sourcesContent":["<template>\r\n  <div id=\"ArticleManger\">\r\n\r\n    <el-input\r\n        class=\"search\"\r\n        placeholder=\"请输入搜索内容\"\r\n        prefix-icon=\"el-icon-search\"\r\n        @input=\"handleSearch\"\r\n        v-model=\"searchTxt\">\r\n    </el-input>\r\n\r\n    <el-table\r\n        :data=\"articleData\"\r\n        border\r\n        style=\"width: 100%\"\r\n    >\r\n      <el-table-column label=\"标题\">\r\n        <template #default=\"scope\">\r\n          <el-input v-model=\"scope.row.title\"></el-input>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"描述\">\r\n        <template #default=\"scope\">\r\n          <el-input v-model=\"scope.row.des\"></el-input>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"重新上传md\" width=\"140px\">\r\n        <template #default=\"scope\">\r\n          <el-upload\r\n              class=\"upload-demo\"\r\n              :action=\"`${baseURL}/adminServer/article/md`\"\r\n              :on-success=\"function(res){md_upload_success(res,scope.row._id)}\"\r\n              :before-upload=\"md_before_upload\"\r\n              :limit=\"1\"\r\n              :with-credentials=\"true\"\r\n              :show-file-list=\"false\"\r\n          >\r\n            <el-button size=\"large\" type=\"success\">点击上传md</el-button>\r\n          </el-upload>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"重新上传封面图\">\r\n        <template #default=\"scope\">\r\n          <div class=\"cover\">\r\n            <el-image\r\n                style=\"width: 200px; height: 150px;\"\r\n                :src=\"`${baseURL}${scope.row.cover}`\"\r\n                :preview-src-list=\"[`${baseURL}${scope.row.cover}`]\"\r\n                preview-teleported=\"true\"\r\n            >\r\n            </el-image>\r\n            <el-upload\r\n                class=\"upload-demo\"\r\n                :action=\"`${baseURL}/adminServer/article/cover`\"\r\n                :on-success=\"function(res){cover_upload_success(res,scope.row._id)}\"\r\n                :before-upload=\"cover_before_upload\"\r\n                :limit=\"1\"\r\n                :with-credentials=\"true\"\r\n                :show-file-list=\"false\"\r\n\r\n            >\r\n              <el-button size=\"large\" type=\"warning\" style=\"margin: auto 0\">重传封面</el-button>\r\n            </el-upload>\r\n          </div>\r\n\r\n        </template>\r\n      </el-table-column>\r\n\r\n      <el-table-column\r\n          fixed=\"right\"\r\n          label=\"操作\">\r\n        <template #default=\"scope\">\r\n          <div class=\"buttonSubmit\">\r\n            <el-button\r\n                type=\"primary\"\r\n                @click=\"update(scope.row._id,{title:scope.row.title,des:scope.row.des})\"\r\n                size=\"large\"\r\n            >修改\r\n            </el-button>\r\n            <el-button\r\n                type=\"danger\"\r\n                @click=\"deleteArticle(scope.row._id)\"\r\n                size=\"large\"\r\n            >删除\r\n            </el-button>\r\n          </div>\r\n\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <el-pagination\r\n        v-if=\"display\"\r\n        background\r\n        layout=\"sizes,prev,pager,next,jumper,->,slot, total\"\r\n        :total=\"total\"\r\n        v-model:page-size=\"query.perPage\"\r\n        v-model:current-page=\"query.page\"\r\n        @current-change=\"getArticles\"\r\n        @size-change=\"getArticles\"\r\n        :page-sizes=\"[2,5,10,20,30]\"\r\n\r\n\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"ArticleManger\",\r\n  data() {\r\n    return {\r\n      articleData: [],\r\n      AllArticleData: [],\r\n      searchTxt: \"\",\r\n      timer: null,\r\n      total: 0,\r\n      display: true,\r\n      query:\r\n          {\r\n            page: 1,\r\n            perPage: 5\r\n          }\r\n    }\r\n  },\r\n  methods: {\r\n\r\n    //搜索\r\n    handleSearch() {\r\n      clearTimeout(this.timer)\r\n      this.timer = setTimeout(() => {\r\n        let txt = this.searchTxt.trim()\r\n        if (!txt) {\r\n          return this.articleData = this.AllArticleData\r\n        }\r\n        let arr = []\r\n        this.AllArticleData.forEach(item => {\r\n          //通过title和des筛选\r\n          if (item.title.includes(txt) || item.des.includes(txt)) {\r\n            arr.push(item)\r\n          }\r\n        })\r\n        this.articleData = arr\r\n      }, 500)\r\n    },\r\n\r\n    //请求所有文章数据\r\n    async getArticles() {\r\n      let {data} = await this.$axios({\r\n        method: \"get\",\r\n        url: \"/get/article\",\r\n        params: this.query\r\n      })\r\n\r\n      if (data.code) {\r\n        return this.$message.error(data.msg)\r\n      }\r\n      this.AllArticleData = data.data\r\n      this.total = data.total\r\n      if (this.total == 0) {\r\n        this.display = false\r\n      }\r\n      this.handleSearch()\r\n    },\r\n\r\n    //更新文章\r\n    async update(id, doc) {\r\n      let {data} = await this.$axios({\r\n        method: \"POST\",\r\n        url: \"/adminServer/article/update\",\r\n        data: {id, doc}\r\n      })\r\n\r\n      if (data.code) {\r\n        return this.$message.error(data.msg)\r\n      }\r\n      this.$message.success(\"更新成功\")\r\n      await this.getArticles()\r\n    },\r\n\r\n    //md上传之前的回调\r\n    md_before_upload(file) {\r\n      let ifMd = /\\.md$/.test(file.name)\r\n      if (!ifMd) {\r\n        this.$message.error(\"请上传md文件\")\r\n      }\r\n      return ifMd\r\n    },\r\n    //md上传成功后的回调\r\n    md_upload_success(res, id) {\r\n      //失败\r\n      if (res.code) {\r\n        return this.$message.error(res.msg)\r\n      }\r\n\r\n      //成功\r\n      this.update(id, {md: res.url})\r\n    },\r\n\r\n    //封面图上传之前的回调\r\n    cover_before_upload(file) {\r\n      const isJPG = /^image\\/(jpeg|png)$/.test(file.type);\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      return isJPG && isLt2M\r\n    },\r\n    //封面图上传成功后的回调\r\n    cover_upload_success(res, id) {\r\n      //失败\r\n      if (res.code) {\r\n        return this.$message.error(res.msg)\r\n      }\r\n\r\n      //成功\r\n      this.update(id, {cover: res.url})\r\n    },\r\n\r\n    //删除文章\r\n    async deleteArticle(id) {\r\n      let {data} = await this.$axios({\r\n        method: \"DELETE\",\r\n        url: \"/adminServer/article/delete\",\r\n        data: {id}\r\n      })\r\n\r\n      if (data.code) {\r\n        return this.$message.error(data.msg)\r\n      }\r\n\r\n      this.$message.success(\"删除完成\")\r\n      await this.getArticles()\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getArticles()\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n#ArticleManger {\r\n  .cover {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n\r\n  .search {\r\n    margin-bottom: 10px;\r\n  }\r\n\r\n  .buttonSubmit {\r\n    width: 70%;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    margin: 0 auto;\r\n  }\r\n}\r\n</style>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"],"names":["_openBlock","_createElementBlock","_createVNode","_withCtx","_createElementVNode","_createBlock"],"mappings":"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"}
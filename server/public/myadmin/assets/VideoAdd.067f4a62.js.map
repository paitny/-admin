{"version":3,"file":"VideoAdd.067f4a62.js","sources":["../../src/views/VideoManage/VideoAdd.vue"],"sourcesContent":["<template>\r\n  <div class=\"videoAdd\">\r\n    <div class=\"videoPhoto\">\r\n      <el-form\r\n          :model=\"form\"\r\n      >\r\n        <el-form-item label=\"标题：\" label-width=\"150px\">\r\n          <el-input\r\n              style=\"height: 50px;width: 500px\"\r\n              v-model=\"form.title\"\r\n              placeholder=\"可通过上传视频文件自动获取文件名\"\r\n          ></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"视频上传：\" label-width=\"150px\" >\r\n          <el-upload\r\n              class=\"upload-demo\"\r\n              drag\r\n              :action=\"`${baseURL}/adminServer/video/videoAdd`\"\r\n              :auto-upload=\"false\"\r\n              :on-change=\"fileChange\"\r\n              :limit=\"1\"\r\n              ref=\"videoForm\"\r\n              :on-success=\"video_upload_success\"\r\n              :with-credentials=\"true\"\r\n          >\r\n            <i class=\"el-icon-upload\"> <el-icon class=\"el-icon--upload\"><upload-filled /></el-icon></i>\r\n            <div class=\"el-upload__text\">将视频格式文件拖到此处，或<em>点击上传</em></div>\r\n          </el-upload>\r\n        </el-form-item>\r\n        <el-form-item label=\"封面图上传：\" label-width=\"150px\">\r\n          <el-upload\r\n              class=\"avatar-uploader\"\r\n              :action=\"`${baseURL}/adminServer/video/videoCover`\"\r\n              :show-file-list=\"false\"\r\n              :on-change=\"videoCoverChange\"\r\n              :on-success=\"videoCover_upload_success\"\r\n              :auto-upload=\"false\"\r\n              ref=\"imgForm\"\r\n              :with-credentials=\"true\"\r\n          >\r\n            <div\r\n                v-if=\"imageUrl\"\r\n                class=\"avatar\"\r\n                :style=\"{\r\n              backgroundImage: `url(${imageUrl})`\r\n            }\"\r\n            >\r\n            </div>\r\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"><el-icon><Plus /></el-icon></i>\r\n          </el-upload>\r\n        </el-form-item>\r\n        <el-form-item\r\n            label-width=\"150px\"\r\n        >\r\n          <el-button type=\"success\" @click=\"submitVideo\" style=\"width: 200px;height: 100px\">确认上传</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"VideoAdd\",\r\n  data(){\r\n    return{\r\n      form:{\r\n        title:\"\",\r\n        video:\"\",\r\n        videoCover:\"\"\r\n      },\r\n      imageUrl: \"\"\r\n    }\r\n  },\r\n  methods:{\r\n\r\n    //视频发表\r\n    async submit(){\r\n      let {data} = await this.$axios({\r\n        method: \"POST\",\r\n        url: \"/adminServer/video/add\",\r\n        data: this.form\r\n      })\r\n      if(data.code){\r\n        return this.$message.error(data.msg)\r\n      }\r\n      await this.$router.push('/Video')\r\n    },\r\n\r\n//上传之前验证\r\n    fileChange(file,fileList){\r\n      if(file.status!=='ready')return\r\n      if( /(.*)\\.(mp4|rmvb|avi|ts|flv|mov|3gb|m3u8)$/.test(file.name)){\r\n        if (this.form.title) return\r\n        this.form.title = RegExp.$1\r\n      }else {\r\n        this.$message.error(\"只能上传.mp4 .avi .flv .rmvb .mov .m3u8 或.3gb格式的文件\")\r\n        fileList.pop()\r\n      }\r\n\r\n    },\r\n    submitVideo(){\r\n      this.$refs.videoForm.submit()\r\n    }\r\n    ,\r\n    beforeRemove() {\r\n      this.form.title = \"\"\r\n    },\r\n    //上传成功的钩子\r\n    video_upload_success(res){\r\n      if (res.code) {\r\n        return this.$message.error(\"上传视频失败，请检查后端报错\")\r\n      }\r\n      this.form.video = res.url\r\n      //判断是否有封面图\r\n      if (this.imageUrl) {\r\n        //有封面图，触发封面图的上传\r\n        this.$refs.imgForm.submit()\r\n      } else {\r\n        //没有封面图，直接发表文章\r\n        this.submit()\r\n      }\r\n    },\r\n    videoCoverChange(file, fileList) {\r\n      if (file.status !== 'ready') return\r\n\r\n      const isJPG = /^image\\/(jpeg|png)$/.test(file.raw.type);\r\n      const isLt2M = file.raw.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      if (isJPG && isLt2M) {\r\n        this.imageUrl = URL.createObjectURL(file.raw);\r\n      } else {\r\n        this.imageUrl = \"\"\r\n        fileList.pop()\r\n      }\r\n    },\r\n    //封面上传成功\r\n    videoCover_upload_success(res) {\r\n      if (res.code) {\r\n        return this.$message.error(\"上传封面失败，请检查后端报错\")\r\n      }\r\n      this.form.videoCover = res.url\r\n      this.submit()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.videoAdd {\r\n  z-index: 999;\r\n  :deep(.avatar-uploader .el-upload)  {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n\r\n  }\r\n\r\n  :deep(.avatar-uploader .el-upload:hover)  {\r\n\r\n    border-color: #409EFF;\r\n  }\r\n  :deep(.avatar-uploader-icon) {\r\n    font-size: 28px;\r\n    color: #8c939d;\r\n    width: 178px;\r\n    height: 178px;\r\n    line-height: 178px;\r\n    text-align: center;\r\n\r\n  }\r\n  :deep(.avatar) {\r\n    width: 178px;\r\n    height: 178px;\r\n    display: block;\r\n    background: none center center/cover;\r\n  }\r\n  :deep(.el-upload-dragger){\r\n    width: 360px;\r\n\r\n  }\r\n\r\n}\r\n\r\n\r\n</style>\r\n"],"names":["_createElementVNode","_openBlock","_createElementBlock","_createVNode","_normalizeStyle"],"mappings":"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"}
import{resolveComponent as c,openBlock as g,createElementBlock as w,createVNode as r,withCtx as l,createElementVNode as h,createBlock as y,createCommentVNode as A,createTextVNode as m}from"https://esm.sh/vue@3.0.5";import{_ as x}from"./index.10c0c1b8.js";import"https://cdn.jsdelivr.net/npm/ant-design-vue@2.2.0-beta.6/lib/grid/style/index.css";import"https://esm.sh/axios@0.21.1";import"https://esm.sh/vuex@4.0.2";import"https://esm.sh/dayjs@1.10.5";import"https://esm.sh/dayjs@1.10.5/plugin/localeData.js";import"https://esm.sh/dayjs@1.10.5/plugin/customParseFormat.js";import"https://esm.sh/dayjs@1.10.5/plugin/advancedFormat.js";import"https://esm.sh/dayjs@1.10.5/plugin/weekOfYear.js";import"https://esm.sh/dayjs@1.10.5/plugin/weekYear.js";import"https://esm.sh/dayjs@1.10.5/plugin/dayOfYear.js";import"https://esm.sh/dayjs@1.10.5/plugin/isSameOrAfter.js";import"https://esm.sh/dayjs@1.10.5/plugin/isSameOrBefore.js";const V={name:"ArticleManger",data(){return{articleData:[],AllArticleData:[],searchTxt:"",timer:null,total:0,display:!0,query:{page:1,perPage:5}}},methods:{handleSearch(){clearTimeout(this.timer),this.timer=setTimeout(()=>{let e=this.searchTxt.trim();if(!e)return this.articleData=this.AllArticleData;let t=[];this.AllArticleData.forEach(i=>{(i.title.includes(e)||i.des.includes(e))&&t.push(i)}),this.articleData=t},500)},async getArticles(){let{data:e}=await this.$axios({method:"get",url:"/get/article",params:this.query});if(e.code)return this.$message.error(e.msg);this.AllArticleData=e.data,this.total=e.total,this.total==0&&(this.display=!1),this.handleSearch()},async update(e,t){let{data:i}=await this.$axios({method:"POST",url:"/adminServer/article/update",data:{id:e,doc:t}});if(i.code)return this.$message.error(i.msg);this.$message.success("\u66F4\u65B0\u6210\u529F"),await this.getArticles()},md_before_upload(e){let t=/\.md$/.test(e.name);return t||this.$message.error("\u8BF7\u4E0A\u4F20md\u6587\u4EF6"),t},md_upload_success(e,t){if(e.code)return this.$message.error(e.msg);this.update(t,{md:e.url})},cover_before_upload(e){const t=/^image\/(jpeg|png)$/.test(e.type),i=e.size/1024/1024<2;return t||this.$message.error("\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u53EA\u80FD\u662F JPG/PNG \u683C\u5F0F!"),i||this.$message.error("\u4E0A\u4F20\u5934\u50CF\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 2MB!"),t&&i},cover_upload_success(e,t){if(e.code)return this.$message.error(e.msg);this.update(t,{cover:e.url})},async deleteArticle(e){let{data:t}=await this.$axios({method:"DELETE",url:"/adminServer/article/delete",data:{id:e}});if(t.code)return this.$message.error(t.msg);this.$message.success("\u5220\u9664\u5B8C\u6210"),await this.getArticles()}},created(){this.getArticles()}},C={id:"ArticleManger"},z=m("\u70B9\u51FB\u4E0A\u4F20md"),S={class:"cover"},U=m("\u91CD\u4F20\u5C01\u9762"),M={class:"buttonSubmit"},k=m("\u4FEE\u6539 "),D=m("\u5220\u9664 ");function T(e,t,i,$,s,o){const p=c("el-input"),d=c("el-table-column"),u=c("el-button"),_=c("el-upload"),f=c("el-image"),b=c("el-table"),v=c("el-pagination");return g(),w("div",C,[r(p,{class:"search",placeholder:"\u8BF7\u8F93\u5165\u641C\u7D22\u5185\u5BB9","prefix-icon":"el-icon-search",onInput:o.handleSearch,modelValue:s.searchTxt,"onUpdate:modelValue":t[0]||(t[0]=a=>s.searchTxt=a)},null,8,["onInput","modelValue"]),r(b,{data:s.articleData,border:"",style:{width:"100%"}},{default:l(()=>[r(d,{label:"\u6807\u9898"},{default:l(a=>[r(p,{modelValue:a.row.title,"onUpdate:modelValue":n=>a.row.title=n},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(d,{label:"\u63CF\u8FF0"},{default:l(a=>[r(p,{modelValue:a.row.des,"onUpdate:modelValue":n=>a.row.des=n},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),r(d,{label:"\u91CD\u65B0\u4E0A\u4F20md",width:"140px"},{default:l(a=>[r(_,{class:"upload-demo",action:`${e.baseURL}/adminServer/article/md`,"on-success":function(n){o.md_upload_success(n,a.row._id)},"before-upload":o.md_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:l(()=>[r(u,{size:"large",type:"success"},{default:l(()=>[z]),_:1})]),_:2},1032,["action","on-success","before-upload"])]),_:1}),r(d,{label:"\u91CD\u65B0\u4E0A\u4F20\u5C01\u9762\u56FE"},{default:l(a=>[h("div",S,[r(f,{style:{width:"200px",height:"150px"},src:`${e.baseURL}${a.row.cover}`,"preview-src-list":[`${e.baseURL}${a.row.cover}`],"preview-teleported":"true"},null,8,["src","preview-src-list"]),r(_,{class:"upload-demo",action:`${e.baseURL}/adminServer/article/cover`,"on-success":function(n){o.cover_upload_success(n,a.row._id)},"before-upload":o.cover_before_upload,limit:1,"with-credentials":!0,"show-file-list":!1},{default:l(()=>[r(u,{size:"large",type:"warning",style:{margin:"auto 0"}},{default:l(()=>[U]),_:1})]),_:2},1032,["action","on-success","before-upload"])])]),_:1}),r(d,{fixed:"right",label:"\u64CD\u4F5C"},{default:l(a=>[h("div",M,[r(u,{type:"primary",onClick:n=>o.update(a.row._id,{title:a.row.title,des:a.row.des}),size:"large"},{default:l(()=>[k]),_:2},1032,["onClick"]),r(u,{type:"danger",onClick:n=>o.deleteArticle(a.row._id),size:"large"},{default:l(()=>[D]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),s.display?(g(),y(v,{key:0,background:"",layout:"sizes,prev,pager,next,jumper,->,slot, total",total:s.total,"page-size":s.query.perPage,"onUpdate:page-size":t[1]||(t[1]=a=>s.query.perPage=a),"current-page":s.query.page,"onUpdate:current-page":t[2]||(t[2]=a=>s.query.page=a),onCurrentChange:o.getArticles,onSizeChange:o.getArticles,"page-sizes":[2,5,10,20,30]},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])):A("",!0)])}var K=x(V,[["render",T],["__scopeId","data-v-eb047bfe"]]);export{K as default};
//# sourceMappingURL=ArticleManager.5cc75792.js.map

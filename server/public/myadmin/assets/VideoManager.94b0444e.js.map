{"version":3,"file":"VideoManager.94b0444e.js","sources":["../../src/views/VideoManage/VideoManager.vue"],"sourcesContent":["<template>\r\n  <el-table\r\n      :data=\"MangerVideo\"\r\n      border\r\n      style=\"width: 100%;height: 100%\"\r\n  >\r\n    <el-table-column\r\n        prop=\"date\"\r\n        label=\"发布日期\"\r\n        :key=\"MangerVideo.date\"\r\n        :formatter=\"dateFormat\"\r\n        align=\"center\"\r\n    >\r\n\r\n    </el-table-column>\r\n    <el-table-column label=\"标题\"\r\n\r\n    >\r\n      <template #default=\"scope\">\r\n        <el-input v-model=\"scope.row.title\"></el-input>\r\n      </template>\r\n    </el-table-column>\r\n\r\n    <el-table-column label=\"重新上传视频\"\r\n                     align=\"center\"\r\n                     width=\"500px\"\r\n    >\r\n      <template #default=\"scope\">\r\n\r\n        <div\r\n\r\n        >\r\n          <vue3VideoPlay :poster=\"`${baseURL}${scope.row.videoCover}`\" :src=\"`${baseURL}${scope.row.video}`\"\r\n                         type=\"video/mp4\" :autoPlay=\"false\"/>\r\n\r\n        </div>\r\n        <el-upload\r\n            class=\"upload-demo\"\r\n            :action=\"`${baseURL}/adminServer/video/videoAdd`\"\r\n            :on-success=\"function(res){video_upload_success(res,scope.row._id)}\"\r\n            :before-upload=\"video_before_upload\"\r\n            :limit=\"1\"\r\n            :with-credentials=\"true\"\r\n            :show-file-list=\"false\"\r\n        >\r\n          <div\r\n              style=\"margin-top:10px \"\r\n          >\r\n            <el-button size=\"large\" type=\"success\">更新视频</el-button>\r\n          </div>\r\n        </el-upload>\r\n      </template>\r\n    </el-table-column>\r\n\r\n    <el-table-column label=\"重新上传封面图\"\r\n\r\n    >\r\n      <template #default=\"scope\">\r\n        <div class=\"videoCover\">\r\n          <el-image\r\n              style=\"width: 150px; height:100px\"\r\n              :src=\"`${baseURL}${scope.row.videoCover}`\"\r\n              :preview-src-list=\"[`${baseURL}${scope.row.videoCover}`]\"\r\n              preview-teleported=\"true\"\r\n          >\r\n          </el-image>\r\n          <el-upload\r\n              class=\"upload-demo\"\r\n              :action=\"`${baseURL}/adminServer/video/videoCover`\"\r\n              :on-success=\"function(res){videoCover_upload_success(res,scope.row._id)}\"\r\n              :before-upload=\"videoCover_before_upload\"\r\n              :limit=\"1\"\r\n              :with-credentials=\"true\"\r\n              :show-file-list=\"false\"\r\n          >\r\n            <el-button size=\"large\" type=\"warning\">重传封面</el-button>\r\n          </el-upload>\r\n        </div>\r\n\r\n      </template>\r\n    </el-table-column>\r\n\r\n    <el-table-column\r\n        fixed=\"right\"\r\n        label=\"操作\"\r\n        width=\"150px\"\r\n        align=\"center\"\r\n    >\r\n      <template #default=\"scope\">\r\n        <div\r\n            style=\"margin-bottom: 50px\"\r\n        >\r\n          <el-button\r\n              type=\"primary\"\r\n              @click=\"update(scope.row._id,{title:scope.row.title})\"\r\n              size=\"large\"\r\n          >修改\r\n          </el-button>\r\n        </div>\r\n\r\n        <div>\r\n          <el-button\r\n              type=\"danger\"\r\n              @click=\"deleteVideo(scope.row._id)\"\r\n              size=\"large\"\r\n          >删除\r\n          </el-button>\r\n        </div>\r\n\r\n\r\n      </template>\r\n    </el-table-column>\r\n  </el-table>\r\n</template>\r\n\r\n<script>\r\nimport moment from 'moment'\r\n\r\nexport default {\r\n  name: \"VideoManger\",\r\n  data() {\r\n    return {\r\n      MangerVideo: [],\r\n    }\r\n  },\r\n  methods: {\r\n    dateFormat: function (row, column) {\r\n      let date = row[column.property];\r\n      if (date == undefined) {\r\n        return \"\";\r\n      }\r\n\r\n      return moment(date).format(\"YYYY-MM-DD HH:mm:ss\");\r\n    },\r\n\r\n    //请求所有视频数据\r\n    async getVideo() {\r\n      let {data} = await this.$axios({\r\n        method: \"get\",\r\n        url: \"/get/video\"\r\n      })\r\n\r\n      if (data.code) {\r\n        return this.$message.error(data.msg)\r\n      }\r\n      this.MangerVideo = data.data\r\n    },\r\n    //更新视频\r\n    async update(id, doc) {\r\n      let {data} = await this.$axios({\r\n        method: \"POST\",\r\n        url: \"/adminServer/video/update\",\r\n        data: {id, doc}\r\n\r\n      })\r\n      if (data.code) {\r\n        return this.$message.error(data.msg)\r\n      }\r\n      this.$message.success(\"更新成功\")\r\n      await this.getVideo()\r\n    },\r\n    //视频上传之前的回调\r\n    video_before_upload(file) {\r\n      let ifVideo = /(.*)\\.(mp4|rmvb|avi|ts|flv|mov|3gb)$/.test(file.name)\r\n      if (!ifVideo) {\r\n        this.$message.error(\"请上传视频文件\")\r\n      }\r\n      return ifVideo\r\n    },\r\n    //视频上传成功后的回调\r\n    video_upload_success(res, id) {\r\n      //失败\r\n      if (res.code) {\r\n        return this.$message.error(res.msg)\r\n      }\r\n      //成功\r\n      this.update(id, {video: res.url})\r\n    },\r\n\r\n    //封面图上传之前的回调\r\n    videoCover_before_upload(file) {\r\n      const isJPG = /^image\\/(jpeg|png)$/.test(file.type);\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n      if (!isJPG) {\r\n        this.$message.error('上传头像图片只能是 JPG/PNG 格式!');\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error('上传头像图片大小不能超过 2MB!');\r\n      }\r\n      return isJPG && isLt2M\r\n    },\r\n    //封面图上传成功后的回调\r\n    videoCover_upload_success(res, id) {\r\n      //失败\r\n      if (res.code) {\r\n        return this.$message.error(res.msg)\r\n      }\r\n      //成功\r\n      this.update(id, {videoCover: res.url})\r\n    }\r\n    ,\r\n    //删除视频\r\n    async deleteVideo(id) {\r\n      let {data} = await this.$axios({\r\n        method: \"DELETE\",\r\n        url: \"/adminServer/video/delete\",\r\n        data: {id}\r\n      })\r\n\r\n      if (data.code) {\r\n        return this.$message.error(data.msg)\r\n      }\r\n\r\n      this.$message.success(\"视频已删除完成\")\r\n      await this.getVideo()\r\n    }\r\n  },\r\n\r\n  created() {\r\n    this.getVideo()\r\n\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.video {\r\n  display: flex;\r\n  justify-content: space-between;\r\n\r\n}\r\n\r\n.videoCover {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  line-height: 100px;\r\n}\r\n\r\n#refPlayerWrap {\r\n  width: 420px;\r\n  height: 230px;\r\n}\r\n</style>\r\n"],"names":["moment","_createBlock","_createVNode","_withCtx","_createElementVNode"],"mappings":"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"}